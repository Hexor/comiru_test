(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2c1e940e"],{"00f0":function(e,t){function n(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}e.exports=n},"4c5f":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"q-pa-md"},[n("q-table",{staticClass:"cn-bold-font",attrs:{title:"学员管理",data:e.data,columns:e.columns,"row-key":"id",pagination:e.pagination,loading:e.loading,filter:e.filter,"rows-per-page-label":"每页显示数量","no-results-label":"没有任何数据","binary-state-sort":""},on:{"update:pagination":function(t){e.pagination=t},request:e.onRequest},scopedSlots:e._u([{key:"body",fn:function(t){return[n("q-tr",{attrs:{props:t}},[n("q-td",{key:"id",attrs:{props:t}},[e._v("\n          "+e._s(t.row.id)+"\n        ")]),n("q-td",{key:"username",attrs:{props:t}},[e._v("\n          "+e._s(t.row.username)+"\n          "),n("q-popup-edit",{staticClass:"cn-bold-font",attrs:{title:"修改用户名 (ID:"+t.row.id+")",buttons:"",color:"adminTitle","label-set":"保存","label-cancel":"取消"},on:{show:function(n){return e.setEditingRow(t.row)},save:e.updateUsername},model:{value:t.row.username,callback:function(n){e.$set(t.row,"username",n)},expression:"props.row.username"}},[n("q-input",{attrs:{color:"adminSecondary",dense:"",autofocus:""},model:{value:t.row.username,callback:function(n){e.$set(t.row,"username",n)},expression:"props.row.username"}})],1)],1),n("q-td",{key:"delete",attrs:{props:t}},[n("q-btn",{attrs:{color:"adminTitle",dense:"",icon:"delete_outline"},on:{click:function(n){return e.deleteUserBtnCallback(t.row)}}})],1)],1)]}},{key:"top-right",fn:function(){return[n("q-input",{attrs:{dense:"",debounce:"300",color:"adminSecondary",placeholder:"搜索用户名, id"},scopedSlots:e._u([{key:"append",fn:function(){return[n("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}})]},proxy:!0}])}),n("q-dialog",{model:{value:e.needConfirmDeleteDialog,callback:function(t){e.needConfirmDeleteDialog=t},expression:"needConfirmDeleteDialog"}},[n("q-card",{staticStyle:{width:"700px","max-width":"80vw"}},[n("q-card-section",[e._v("\n        确认删除该用户吗? 这同时也将删除该用户的 Line 绑定与教师关注数据.\n      ")]),n("q-card-section",{attrs:{caption:""}},[n("q-item-label",{staticStyle:{"font-size":"14px"},attrs:{caption:""}},[e._v("\n          "+e._s(e.deletingRow)+"\n        ")])],1),n("q-card-actions",{staticClass:"bg-white text-adminPrimary",attrs:{align:"right"}},[n("q-btn",{directives:[{name:"close-dialog",rawName:"v-close-dialog"}],attrs:{color:"",flat:"",label:"关闭"}}),n("q-btn",{directives:[{name:"close-dialog",rawName:"v-close-dialog"}],staticClass:"text-white bg-adminTitle",attrs:{label:"确认删除"},on:{click:e.sureToDeleteUser}})],1)],1)],1)],1)},o=[],i=n("8e72"),r=n.n(i),s=n("bc3a"),l=n.n(s),c=n("b178"),d={data:function(){return{deletingRow:null,selected:[],errorUsername:!1,errorMessageUsername:"",search:"",leaveMessageTextValue:"",needConfirmDeleteDialog:!1,tgLoginDialogStatus:!1,confirm:!1,contactCard:!1,disableScroll:!1,show:!0,componentKey:0,page:1,items:[],info:"",targetItem:[],messagePlaceHolder:"",requestListPrefix:"",filter:"",loading:!1,pagination:{sortBy:"id",descending:!0,page:1,rowsPerPage:10,rowsNumber:10},columns:[{name:"id",required:!0,label:"ID",align:"left",field:function(e){return e.id},format:function(e){return"".concat(e)},sortable:!0},{name:"username",required:!0,label:"用户名(点击直接编辑)",align:"left",field:function(e){return e.username},format:function(e){return"".concat(e)},sortable:!0},{name:"delete",required:!0,label:"操作",align:"center"}],data:[],editingRow:null}},mounted:function(){var e=window.screen.height;console.log(e),this.pagination.rowsPerPage=Math.round((e-390)/40)-1,this.pagination.rowsPerPage<1&&(this.pagination.rowsPerPage=1),this.onRequest({pagination:this.pagination,filter:""})},methods:{removeUserFromDisplay:function(e){for(var t=0;t<this.data.length;t++)this.data[t]["id"]===e&&this.data.splice(t,1)},deleteUserBtnCallback:function(e){this.deletingRow=e,this.needConfirmDeleteDialog=!0},sureToDeleteUser:function(){var e=this,t=this.deletingRow;this.$q.loading.show({spinner:c["b"],spinnerSize:40,spinnerColor:"adminSecondary",backgroundColor:"white"});var n=this;l.a.delete("admin/students/"+t.id).then(function(a){n.removeUserFromDisplay(t.id),e.$q.notify({color:"adminPrimary",icon:"delete_outline",message:"删除成功 !",timeout:500})}).catch(function(t){e.handleErrorResponse(t)}).then(function(){n.$q.loading.hide({delay:500}),n.deletingRow=null})},setEditingRow:function(e){this.editingRow=e},updateUsername:function(e,t){var n=this;console.log("update"+e),this.$q.loading.show({spinner:c["b"],spinnerSize:40,spinnerColor:"adminSecondary",backgroundColor:"white"});var a={username:e},o=this;l.a.patch("admin/students/"+this.editingRow.id,a).then(function(e){n.$q.notify({color:"adminPrimary",icon:"thumb_up",message:"修改成功 !",timeout:500})}).catch(function(e){n.editingRow.username=t,n.handleErrorResponse(e)}).then(function(){o.$q.loading.hide({delay:500}),this.editingRow=null})},onRequest:function(e){console.log("onrequest");var t=e.pagination,n=t.page,a=t.rowsPerPage,o=t.sortBy,i=t.descending,r=e.filter;this.fetchFromServer(n,a,r,o,i)},fetchFromServer:function(e,t,n,a,o){var i=this,s="asc";o&&(s="desc"),this.loading=!0,l.a.get("admin/students?page_size="+t+"&page="+e+"&keyword="+n+"&sort="+a+"|"+s).then(function(n){var s,l=n["data"]["data"];(s=i.data).splice.apply(s,[0,i.data.length].concat(r()(l))),i.pagination.page=e,i.pagination.rowsPerPage=t,i.pagination.sortBy=a,i.pagination.descending=o,i.pagination.rowsNumber=n["data"]["total"]}).catch(function(e){i.handleErrorResponse(e)}).then(function(){i.loading=!1})}}},u=d,p=n("2877"),g=Object(p["a"])(u,a,o,!1,null,null,null);t["default"]=g.exports},5121:function(e,t){function n(){throw new TypeError("Invalid attempt to spread non-iterable instance")}e.exports=n},"8e72":function(e,t,n){var a=n("00f0"),o=n("b6b4"),i=n("5121");function r(e){return a(e)||o(e)||i()}e.exports=r},b6b4:function(e,t){function n(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}e.exports=n}}]);