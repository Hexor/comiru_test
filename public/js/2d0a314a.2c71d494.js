(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d0a314a"],{"013f":function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"q-pa-md full-width absolute-center",staticStyle:{"max-width":"500px"}},[s("q-card",{attrs:{bordered:""}},[s("q-card-section",[s("div",{staticClass:"text-h6"},[t._v("登录 Comiru")])]),s("q-separator",{attrs:{inset:""}}),s("q-card-section",[s("form",{staticClass:"q-gutter-md",on:{submit:function(e){return e.preventDefault(),e.stopPropagation(),t.onSubmit(e)}}},[s("q-input",{ref:"username",attrs:{filled:"",label:"用户名","lazy-rules":"",rules:[function(t){return t&&t.length>0||"请输入用户名"}]},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),s("q-input",{ref:"password",attrs:{"lazy-rules":"",rules:[function(t){return t&&t.length>0||"请输入密码"}],label:"密码",filled:"",type:t.isPwd?"password":"text"},scopedSlots:t._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:t.isPwd?"visibility_off":"visibility"},on:{click:function(e){t.isPwd=!t.isPwd}}})]},proxy:!0}]),model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),s("q-radio",{attrs:{val:"student",label:"我是学员"},model:{value:t.signType,callback:function(e){t.signType=e},expression:"signType"}}),s("q-radio",{attrs:{val:"teacher",label:"我是教师"},model:{value:t.signType,callback:function(e){t.signType=e},expression:"signType"}}),s("div",{staticClass:"row items-center justify-between"},[s("q-btn",{staticClass:"col",staticStyle:{width:"150px"},attrs:{type:"submit",loading:t.loading,color:"primary"},scopedSlots:t._u([{key:"loading",fn:function(){return[s("q-spinner-hourglass",{staticClass:"on-left"}),t._v("\n              登录中...\n            ")]},proxy:!0}])},[t._v("\n            登录\n            ")])],1),s("div",{staticClass:"row items-center"},[s("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.isShowLineBtn(),expression:"isShowLineBtn()"}],staticClass:"col",staticStyle:{width:"170px","background-color":"#00C300",color:"white"},attrs:{icon:"fab fa-line",label:t.lineBtnText},on:{click:t.lineBtnCallback}})],1),s("div",{staticClass:"row items-center"},[s("q-btn",{staticClass:"col",attrs:{flat:"",color:"primary"},on:{click:t.registerBtnCallback}},[t._v("没有帐号? 现在注册\n          ")])],1)],1)])],1)],1)},i=[],a=(s("7f7f"),s("bc3a")),r=s.n(a),o={data:function(){return{lineBtnText:"使用 Line 登录",loading:!1,formHasError:!1,signType:"student",isPwd:!0,password:null,username:null}},mounted:function(){this.isLineTokenInLocal()},methods:{isShowLineBtn:function(){return"/auth/bind_login"!==this.$route.path&&!this.isLineTokenInLocal()&&!this.isLineTokenInServer()},registerBtnCallback:function(){"/auth/bind_login"===this.$route.path?this.$router.push("/auth/bind_register"):this.$router.push("/auth/register")},lineBtnCallback:function(){this.startLoginAsLineProcess()},onSubmit:function(){var t=this;if(this.$refs.username.validate(),this.$refs.password.validate(),this.$refs.username.hasError||this.$refs.password.hasError)this.formHasError=!0;else{this.loading=!0;var e=this;if("/auth/bind_login"===this.$route.path){var s="",n={username:this.username,password:this.password,sign_type:this.signType};if(this.isLineTokenInServer())s=this.getLocalTokenType()+"/bind_user";else if(this.isLineTokenInLocal()){s="line/bind_user";var i=this.$q.localStorage.getItem("line_access_token");n["line_token"]=i}r.a.post(s,n).then(function(t){e.$q.notify({color:"info",icon:"thumb_up",message:"登录成功 !",timeout:500}),e.$router.push({path:"/auth/switch"})}).catch(function(e){t.handleErrorResponse(e)}).then(function(){e.loading=!1})}else r.a.post("auth/signin",{username:e.username,password:e.password,sign_type:e.signType}).then(function(s){var n=new Date;e.updateLocalStorageTokenInfo(s.data.access_token,e.signType,n.getTime()+1e3*s.data.expires_in,s.data.line_exist_in_server),t.$q.notify({color:"info",icon:"thumb_up",message:"登录成功 !",timeout:500}),e.$router.push({path:"/"+e.signType})}).catch(function(e){t.handleErrorResponse(e)}).then(function(){e.loading=!1})}},onReset:function(){this.name=null,this.age=null,this.$refs.name.resetValidation(),this.$refs.age.resetValidation()}}},l=o,u=s("2877"),c=Object(u["a"])(l,n,i,!1,null,null,null);e["default"]=c.exports}}]);