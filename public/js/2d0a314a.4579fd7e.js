(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d0a314a"],{"013f":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"q-pa-md full-width absolute-center",staticStyle:{"max-width":"500px"}},[s("q-card",{attrs:{bordered:""}},[s("q-card-section",[s("div",{staticClass:"text-h6"},[e._v("登录 Comiru")])]),s("q-separator",{attrs:{inset:""}}),s("q-card-section",[s("form",{staticClass:"q-gutter-md",on:{submit:function(t){return t.preventDefault(),t.stopPropagation(),e.onSubmit(t)}}},[s("q-input",{ref:"username",attrs:{filled:"",label:"用户名","lazy-rules":"",rules:[function(e){return e&&e.length>0||"请输入用户名"}]},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),s("q-input",{ref:"password",attrs:{"lazy-rules":"",rules:[function(e){return e&&e.length>0||"请输入密码"}],label:"密码",filled:"",type:e.isPwd?"password":"text"},scopedSlots:e._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:e.isPwd?"visibility_off":"visibility"},on:{click:function(t){e.isPwd=!e.isPwd}}})]},proxy:!0}]),model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),s("q-radio",{attrs:{val:"student",label:"我是学员"},model:{value:e.signType,callback:function(t){e.signType=t},expression:"signType"}}),s("q-radio",{attrs:{val:"teacher",label:"我是教师"},model:{value:e.signType,callback:function(t){e.signType=t},expression:"signType"}}),s("div",{staticClass:"row items-center justify-between"},[s("q-btn",{staticClass:"col",staticStyle:{width:"150px"},attrs:{type:"submit",loading:e.loading,color:"primary"},scopedSlots:e._u([{key:"loading",fn:function(){return[s("q-spinner-hourglass",{staticClass:"on-left"}),e._v("\n              登录中...\n            ")]},proxy:!0}])},[e._v("\n            登录\n            ")])],1),s("div",{staticClass:"row items-center"},[s("q-btn",{directives:[{name:"show",rawName:"v-show",value:e.isShowLineBtn(),expression:"isShowLineBtn()"}],staticClass:"col",staticStyle:{width:"170px","background-color":"#00C300",color:"white"},attrs:{icon:"fab fa-line",label:e.lineBtnText},on:{click:e.lineBtnCallback}})],1),s("div",{staticClass:"row items-center"},[s("q-btn",{staticClass:"col",attrs:{flat:"",color:"primary"},on:{click:e.registerBtnCallback}},[e._v("没有帐号? 现在注册\n          ")])],1)],1)])],1)],1)},i=[],a=(s("7f7f"),s("bc3a")),o=s.n(a),r={data:function(){return{lineBtnText:"使用 Line 登录",loading:!1,formHasError:!1,signType:"student",isPwd:!0,password:null,username:null}},mounted:function(){this.isLineTokenInLocal()},methods:{isShowLineBtn:function(){return"/auth/bind_login"!==this.$route.path&&!this.isLineTokenInLocal()&&!this.isLineTokenInServer()},registerBtnCallback:function(){"/auth/bind_login"===this.$route.path?this.$router.push("/auth/bind_register"):this.$router.push("/auth/register")},lineBtnCallback:function(){this.startLoginAsLineProcess()},onSubmit:function(){var e=this;if(this.$refs.username.validate(),this.$refs.password.validate(),this.$refs.username.hasError||this.$refs.password.hasError)this.formHasError=!0;else{this.loading=!0;var t=this;if("/auth/bind_login"===this.$route.path){var s="",n={username:this.username,password:this.password,sign_type:this.signType};if(this.isLineTokenInServer())s=this.getLocalTokenType()+"/bind_user";else if(this.isLineTokenInLocal()){s="line/bind_user";var i=this.$q.localStorage.getItem("line_access_token");n["line_token"]=i}o.a.post(s,n).then(function(e){t.$q.notify({color:"info",icon:"thumb_up",message:"登录成功 !",timeout:500}),t.$router.push({path:"/auth/switch"})}).catch(function(e){var s=e.response.data.message;t.$q.notify({multiLine:!0,color:"negative",message:s})}).then(function(){t.loading=!1})}else o.a.post("auth/signin",{username:t.username,password:t.password,sign_type:t.signType}).then(function(s){var n=new Date;t.updateLocalStorageTokenInfo(s.data.access_token,t.signType,n.getTime()+1e3*s.data.expires_in,s.data.line_exist_in_server),e.$q.notify({color:"info",icon:"thumb_up",message:"登录成功 !",timeout:500}),t.$router.push({path:"/"})}).catch(function(e){var s=e.response.data.message;t.$q.notify({multiLine:!0,color:"negative",message:s})}).then(function(){t.loading=!1})}},onReset:function(){this.name=null,this.age=null,this.$refs.name.resetValidation(),this.$refs.age.resetValidation()}}},l=r,u=s("2877"),c=Object(u["a"])(l,n,i,!1,null,null,null);t["default"]=c.exports}}]);